<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AgentFlow</title>
  <link href="https://cdn.jsdelivr.net/npm/daisyui@5" rel="stylesheet" type="text/css" />
  <link href="https://cdn.jsdelivr.net/npm/daisyui@5/themes.css" rel="stylesheet" type="text/css" />
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  <!-- Prevent FOUC: hide until Tailwind browser runtime processes styles -->
  <style>html { opacity: 0; }</style>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Geist+Mono:wght@100..900&display=swap" rel="stylesheet" />
  <style type="text/tailwindcss">
    @theme {
      --font-mono: 'Geist Mono', monospace;
    }
    html { opacity: 1; }
    body { min-height: 100vh; font-family: 'Geist Mono', monospace; }
    .session-item { cursor: pointer; outline: none; transition: background 0.15s; }
    .session-item:hover { background: color-mix(in oklch, var(--color-base-content) 8%, transparent); }
    .session-item.active { background: color-mix(in oklch, var(--color-base-content) 12%, transparent); }
    .event-row { outline: none; transition: background 0.15s; position: absolute; top: 0; left: 0; right: 0; display: flex; align-items: flex-start; overflow: hidden; height: 30px; box-sizing: border-box; }
    .event-row:hover { background: color-mix(in oklch, var(--color-base-content) 5%, transparent); }
    .event-row.selected { background: color-mix(in oklch, var(--color-base-content) 10%, transparent); }
    .event-row .cell-time { flex-shrink: 0; padding: 6px 6px 6px 10px; }
    .event-row .cell-content { flex: 1; min-width: 0; padding: 6px 10px 6px 0; overflow: hidden; }
    .event-row .cell-content > * { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .event-detail { max-height: 200px; overflow-y: auto; }
    #session-list:focus, #event-panel:focus { outline: none; }
    .resize-handle-x { width: 4px; cursor: col-resize; transition: background 0.15s; flex-shrink: 0; }
    .resize-handle-x:hover, .resize-handle-x.active { background: color-mix(in oklch, var(--color-primary) 50%, transparent); }
    .resize-handle-y { height: 4px; cursor: row-resize; transition: background 0.15s; flex-shrink: 0; }
    .resize-handle-y:hover, .resize-handle-y.active { background: color-mix(in oklch, var(--color-primary) 50%, transparent); }
    @keyframes spin { to { transform: rotate(360deg); } }
    .css-spinner { display: inline-block; width: 12px; height: 12px; border: 1.5px solid currentColor; border-top-color: transparent; border-radius: 50%; animation: spin 0.6s linear infinite; opacity: 0.6; }

    /* Bubble view */
    .agent-bubble {
      width: 220px; border-radius: 12px; border: 1px solid var(--color-base-300);
      padding: 12px; cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s, opacity 0.4s;
      opacity: 0; transform: scale(0.85);
    }
    .agent-bubble.visible { opacity: 1; transform: scale(1); }
    .agent-bubble.exiting { opacity: 0; transform: scale(0.85); pointer-events: none; }
    .agent-bubble:hover { transform: scale(1.04); box-shadow: 0 4px 16px oklch(0% 0 0 / 0.3); }
    /* Cooking bubbles float actively */
    .agent-bubble.cooking { animation: bubble-float 3s ease-in-out infinite; }
    .agent-bubble.cooking.visible { animation: bubble-float 3s ease-in-out infinite; }
    /* Waiting bubbles are still */
    .agent-bubble.waiting { animation: none; }
    @keyframes bubble-float {
      0%, 100% { translate: 0 0; }
      50% { translate: 0 -4px; }
    }
    @keyframes bubble-pulse {
      0% { box-shadow: 0 0 0 0 color-mix(in oklch, var(--color-primary) 40%, transparent); }
      70% { box-shadow: 0 0 0 8px color-mix(in oklch, var(--color-primary) 0%, transparent); }
      100% { box-shadow: 0 0 0 0 color-mix(in oklch, var(--color-primary) 0%, transparent); }
    }
    .agent-bubble.pulse { animation: bubble-pulse 0.6s ease-out, bubble-float 3s ease-in-out infinite; }
    .bubble-section-empty { display: none; }
    .bubble-section:has(.agent-bubble:not(.exiting)) .bubble-section-empty { display: none; }
    .bubble-category { min-height: 48px; }

    /* Bubble hover tooltip */
    .bubble-tooltip {
      position: fixed; z-index: 100; pointer-events: none;
      max-width: 360px; min-width: 180px;
      background: var(--color-base-200); border: 1px solid var(--color-base-300);
      border-radius: 8px; padding: 8px 10px;
      font-size: 12px; line-height: 1.5;
      color: color-mix(in oklch, var(--color-base-content) 80%, transparent);
      box-shadow: 0 4px 16px oklch(0% 0 0 / 0.3);
      opacity: 0; transition: opacity 0.15s;
      white-space: pre-wrap; word-break: break-word;
      overflow: hidden; display: -webkit-box; -webkit-line-clamp: 8; -webkit-box-orient: vertical;
    }
    .bubble-tooltip.visible { opacity: 1; }

    /* Archive button hover-reveal */
    .archive-btn { opacity: 0; transition: opacity 0.15s; }
    .session-item:hover .archive-btn, .agent-bubble:hover .archive-btn { opacity: 0.5; }
    .archive-btn:hover { opacity: 1 !important; }

    /* Insight list items — compact single-line */
    .insight-item-compact {
      cursor: pointer; outline: none; transition: all 0.15s ease;
      border-left: 3px solid transparent;
      border-bottom: 1px solid var(--color-base-300);
      padding: 6px 12px;
      display: flex; align-items: center; justify-content: space-between; gap: 8px;
    }
    .insight-item-compact:hover { background: color-mix(in oklch, var(--color-base-content) 5%, transparent); }
    .insight-item-compact.active {
      background: color-mix(in oklch, var(--color-primary) 10%, transparent);
      border-left-color: var(--color-primary);
    }
    .insight-item-compact .insight-preview-compact {
      font-size: 12px; line-height: 1.4;
      color: color-mix(in oklch, var(--color-base-content) 80%, transparent);
    }
    .insight-item-compact .insight-meta-compact {
      font-size: 10px; white-space: nowrap;
      color: color-mix(in oklch, var(--color-base-content) 45%, transparent);
    }
    .insight-item-compact .insight-badge {
      background: var(--color-base-300);
      color: color-mix(in oklch, var(--color-base-content) 70%, transparent);
      border: 1px solid var(--color-base-300);
      font-weight: 500; white-space: nowrap;
    }
    .insight-item-compact .insight-badge-error {
      background: color-mix(in oklch, var(--color-error) 15%, transparent);
      color: var(--color-error);
      border-color: color-mix(in oklch, var(--color-error) 30%, transparent);
    }

    /* Insight content styling */
    .insight-content {
      line-height: 1.75;
      color: color-mix(in oklch, var(--color-base-content) 85%, transparent);
      font-size: 14px;
    }
    .insight-content h1 {
      font-size: 20px; font-weight: 600; margin-top: 32px; margin-bottom: 16px;
      color: var(--color-base-content); letter-spacing: -0.02em;
    }
    .insight-content h2 {
      font-size: 16px; font-weight: 600; margin-top: 28px; margin-bottom: 12px;
      color: var(--color-base-content); letter-spacing: -0.01em;
      padding-bottom: 8px; border-bottom: 1px solid var(--color-base-300);
    }
    .insight-content h3 {
      font-size: 14px; font-weight: 600; margin-top: 20px; margin-bottom: 8px;
      color: color-mix(in oklch, var(--color-base-content) 90%, transparent);
    }
    .insight-content p { margin-bottom: 16px; }
    .insight-content ul, .insight-content ol { margin-left: 20px; margin-bottom: 16px; }
    .insight-content li { margin-bottom: 8px; padding-left: 4px; }
    .insight-content li::marker { color: color-mix(in oklch, var(--color-base-content) 40%, transparent); }
    .insight-content hr { margin: 24px 0; border: none; height: 1px; background: var(--color-base-300); }
    .insight-content em { color: color-mix(in oklch, var(--color-base-content) 50%, transparent); font-size: 12px; font-style: normal; }
    .insight-content strong { font-weight: 600; color: var(--color-base-content); }
    .insight-content code {
      background: var(--color-base-300); padding: 2px 6px; border-radius: 4px;
      font-size: 13px; border: 1px solid var(--color-base-300);
    }
    .insight-content > h2:first-child { margin-top: 0; }

    /* Action items section at top of detail */
    .insight-actions-section { margin-bottom: 16px; }
    .insight-actions-section h2 {
      font-size: 16px; font-weight: 600; margin-bottom: 12px;
      color: var(--color-base-content); letter-spacing: -0.01em;
      padding-bottom: 8px; border-bottom: 1px solid var(--color-base-300);
    }
    .insight-actions-section ul { margin-left: 20px; margin-bottom: 8px; }
    .insight-actions-section li { margin-bottom: 6px; font-size: 14px; line-height: 1.6; }
    .insight-actions-section strong { font-weight: 600; color: var(--color-base-content); }

    /* Collapsible reasoning details */
    .insight-reasoning-details {
      border: 1px solid var(--color-base-300); border-radius: 8px;
      overflow: hidden;
    }
    .insight-reasoning-details summary {
      cursor: pointer; padding: 10px 16px;
      font-size: 13px; font-weight: 500;
      color: color-mix(in oklch, var(--color-base-content) 60%, transparent);
      background: color-mix(in oklch, var(--color-base-300) 30%, transparent);
      user-select: none; list-style: none;
    }
    .insight-reasoning-details summary::before {
      content: '▸ '; font-size: 11px; margin-right: 4px;
    }
    .insight-reasoning-details[open] summary::before {
      content: '▾ ';
    }
    .insight-reasoning-details summary:hover {
      color: var(--color-base-content);
    }
    .insight-reasoning-body { padding: 16px; }
    .insight-content ul ul, .insight-content ol ol { margin-top: 8px; margin-bottom: 0; }
    .insight-content blockquote {
      border-left: 3px solid var(--color-base-300); padding-left: 16px;
      margin: 16px 0; color: color-mix(in oklch, var(--color-base-content) 60%, transparent); font-style: italic;
    }
    .insight-content pre {
      background: var(--color-base-200); border: 1px solid var(--color-base-300);
      border-radius: 6px; padding: 12px 16px; overflow-x: auto; margin: 16px 0;
    }
    .insight-content pre code { background: none; border: none; padding: 0; }

    /* Feed entry items */
    .feed-entry {
      padding: 10px 16px; border-bottom: 1px solid var(--color-base-200);
      transition: background 0.15s;
    }
    .feed-entry:hover { background: color-mix(in oklch, var(--color-base-content) 3%, transparent); }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(-4px); } to { opacity: 1; transform: translateY(0); } }
  </style>
  <style>
    /* Mobile responsive — plain CSS, not processed by Tailwind */
    @media (max-width: 767px) {
      /* Layout */
      #sidebar { width: 100% !important; max-width: 100% !important; min-width: 0 !important; }
      #sidebar-handle { display: none !important; }
      #sidebar.mobile-hidden { display: none !important; }
      #main-panel.mobile-hidden { display: none !important; }
      #mobile-back { display: flex !important; }
      .resize-handle-y { display: none !important; }
      #detail-panel { max-height: 50vh !important; }

      /* Navbar: compact for mobile */
      .navbar { padding-left: 12px; padding-right: 12px; }
      .navbar .badge-ghost { display: none; }

      /* Bubbles: full-width stacked */
      .agent-bubble { width: 100% !important; padding: 12px; }
      .cooking-container, .waiting-container { flex-direction: column; }
      #bubble-inner { padding: 12px; }

      /* Session list: larger tap targets */
      .session-item { padding: 12px; }

      /* Back button: more prominent */
      #mobile-back { padding: 10px 12px; }
      #mobile-back span { font-size: 13px; }

      /* Event panel text sizes */
      .event-row .cell-time, .event-row .cell-content { padding-top: 6px; padding-bottom: 6px; }

      /* Insights: full-width stacked on mobile */
      #insights-sidebar { width: 100% !important; max-width: 100% !important; min-width: 0 !important; }
      #insights-sidebar-handle { display: none !important; }
      #insights-sidebar.mobile-hidden { display: none !important; }
      #insights-main.mobile-hidden { display: none !important; }
      #insights-mobile-back { display: flex !important; }

      /* Help dialog tabs: horizontal scroll */
      #setup-tabs { overflow-x: auto; -webkit-overflow-scrolling: touch; flex-wrap: nowrap; }
      #setup-tabs button { flex-shrink: 0; }

      /* Integrations: full-width on mobile */
      #integrations-sidebar { width: 100% !important; max-width: 100% !important; min-width: 0 !important; }
      #integrations-sidebar.mobile-hidden { display: none !important; }
      #integrations-main.mobile-hidden { display: none !important; }
    }
  </style>
</head>
<body class="bg-base-100 text-base-content">

  <!-- Navbar -->
  <div class="navbar bg-base-200 px-4 min-h-10 h-10 border-b border-base-300">
    <div class="flex-1 min-w-0">
      <span id="btn-title" class="text-sm font-bold tracking-tight cursor-pointer hover:opacity-70 transition-opacity" title="Back to overview (v)">AgentFlow</span>
    </div>
    <div class="flex-none gap-1 sm:gap-2">
      <span id="connection-dot" class="inline-block w-2 h-2 rounded-full bg-base-300" title="connecting..."></span>
      <button id="btn-feed" class="btn btn-xs btn-ghost" title="Live feed (f)">
        <i data-lucide="radio" class="w-3.5 h-3.5"></i>
      </button>
      <button id="btn-insights" class="btn btn-xs btn-ghost" title="View insights (i)">
        <i data-lucide="lightbulb" class="w-3.5 h-3.5"></i>
      </button>
      <button id="btn-integrations" class="btn btn-xs btn-ghost" title="Integrations">
        <i data-lucide="plug" class="w-3.5 h-3.5"></i>
      </button>
      <div class="dropdown dropdown-end">
        <button tabindex="0" class="btn btn-xs btn-ghost" title="Switch theme">
          <i data-lucide="palette" class="w-3.5 h-3.5"></i>
        </button>
        <ul tabindex="0" id="theme-menu" class="dropdown-content menu menu-xs bg-base-200 border border-base-300 rounded-lg z-50 w-36 p-1 shadow-lg mt-1 max-h-64 overflow-y-auto">
        </ul>
      </div>
      <button id="btn-help" class="btn btn-xs btn-ghost" title="Setup guide (?)">?</button>
      <button id="btn-invite" class="btn btn-xs btn-ghost" title="Invite user">
        <i data-lucide="user-plus" class="w-3.5 h-3.5"></i>
      </button>
      <button id="btn-signout" class="btn btn-xs btn-ghost text-error" title="Sign out">
        <i data-lucide="log-out" class="w-3.5 h-3.5"></i>
      </button>
    </div>
  </div>

  <!-- Connection overlay (hidden by default, shown after delay if not connected) -->
  <div id="connection-overlay" class="fixed inset-0 z-50 bg-base-100/80 backdrop-blur-sm flex items-center justify-center hidden">
    <div class="text-center">
      <span class="css-spinner w-5 h-5 border-2"></span>
      <p id="connection-overlay-text" class="text-xs opacity-50 mt-3">Connecting...</p>
    </div>
  </div>

  <!-- Bubble View (default) -->
  <div id="bubble-view" class="h-[calc(100vh-2.5rem)] flex flex-col">
    <div class="px-3 sm:px-4 py-2 border-b border-base-300 flex items-center justify-between gap-2">
      <div class="flex items-center gap-2 min-w-0">
        <span class="font-semibold text-[10px] sm:text-[10px] opacity-50 uppercase tracking-wider whitespace-nowrap">Active Sessions</span>
        <span id="bubble-count" class="badge badge-sm badge-ghost text-[10px]">0</span>
      </div>
      <div class="flex items-center gap-2">
        <button id="btn-clear-waiting" class="btn btn-xs btn-ghost opacity-40 hover:opacity-100 text-[10px] hidden" title="Archive all waiting sessions">clear waiting</button>
        <div class="dropdown dropdown-end">
          <div id="bubble-user-filter" tabindex="0" role="button" class="btn btn-xs btn-ghost text-[10px] gap-1" data-value="">All users <span class="opacity-40">▾</span></div>
          <ul id="bubble-user-menu" tabindex="0" class="dropdown-content menu menu-xs bg-base-200 border border-base-300 rounded-lg z-50 w-44 p-1 shadow-lg mt-1 max-h-48 overflow-y-auto"></ul>
        </div>
      </div>
    </div>
    <div id="bubble-scroll" class="flex-1 overflow-y-auto">
      <div id="bubble-inner" class="max-w-4xl mx-auto w-full p-6 space-y-6">
      <div id="bubble-empty" class="flex items-center justify-center h-full">
        <div class="text-center opacity-40">
          <p class="text-sm mb-1">No active sessions</p>
          <p class="text-[10px]">Bubbles appear here when agents are running</p>
          <button onclick="switchView('list')" class="btn btn-xs btn-ghost mt-3 opacity-70">View all sessions</button>
        </div>
      </div>
      <!-- Cooking section -->
      <div id="section-cooking" class="bubble-section hidden">
        <div class="flex items-center gap-2 mb-3">
          <span class="css-spinner"></span>
          <span class="text-[10px] font-semibold uppercase tracking-wider opacity-50">Cooking</span>
          <span id="cooking-count" class="badge badge-xs badge-ghost text-[9px]">0</span>
        </div>
        <div id="cooking-container" class="bubble-category flex flex-wrap gap-4"></div>
      </div>
      <!-- Waiting section -->
      <div id="section-waiting" class="bubble-section hidden">
        <div class="flex items-center gap-2 mb-3">
          <span class="text-[10px] opacity-30">&#9679;</span>
          <span class="text-[10px] font-semibold uppercase tracking-wider opacity-50">Waiting for response</span>
          <span id="waiting-count" class="badge badge-xs badge-ghost text-[9px]">0</span>
        </div>
        <div id="waiting-container" class="bubble-category flex flex-wrap gap-4"></div>
      </div>
      </div> <!-- /bubble-inner -->
    </div>
  </div>

  <!-- List View -->
  <div id="list-view" class="flex h-[calc(100vh-2.5rem)] hidden">

    <!-- Session List (Left Panel) -->
    <div id="sidebar" class="border-r border-base-300 overflow-y-auto bg-base-100 flex flex-col" style="width:256px;min-width:120px;max-width:50vw;">
      <div class="px-3 py-2 border-b border-base-300 flex items-center justify-between gap-2">
        <span class="font-semibold text-[10px] opacity-50 uppercase tracking-wider whitespace-nowrap">Sessions</span>
        <div class="dropdown dropdown-end">
          <div id="user-filter" tabindex="0" role="button" class="btn btn-xs btn-ghost text-[10px] gap-1" data-value="">All users <span class="opacity-40">▾</span></div>
          <ul id="user-filter-menu" tabindex="0" class="dropdown-content menu menu-xs bg-base-200 border border-base-300 rounded-lg z-50 w-44 p-1 shadow-lg mt-1 max-h-48 overflow-y-auto"></ul>
        </div>
      </div>
      <div id="session-list" class="flex-1 overflow-y-auto" tabindex="-1">
        <div class="p-4 text-center opacity-40 text-xs">No sessions yet</div>
      </div>
    </div>
    <div id="sidebar-handle" class="resize-handle-x"></div>

    <!-- Event Timeline (Right Panel) -->
    <div id="main-panel" class="flex-1 flex flex-col overflow-hidden">
      <!-- Mobile back button (hidden on desktop) -->
      <div id="mobile-back" class="hidden items-center gap-2 px-3 py-2.5 border-b border-base-300 bg-base-100 cursor-pointer active:bg-base-200 transition-colors" onclick="mobileBack()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="opacity-50"><path d="M15 18l-6-6 6-6"/></svg>
        <span class="text-xs font-medium opacity-60">Sessions</span>
      </div>
      <!-- Session toolbar (visible when a session is selected) -->
      <div id="session-toolbar" class="hidden items-center justify-end gap-1 px-3 py-1.5 border-b border-base-200 bg-base-100">
        <button id="btn-copy-conversation" class="btn btn-xs btn-ghost opacity-50 hover:opacity-100 gap-1" title="Copy conversation">
          <i data-lucide="copy" class="w-3 h-3"></i>
          <span class="text-[10px]">Copy</span>
        </button>
      </div>
      <div id="empty-state" class="flex items-center justify-center flex-1">
        <div class="text-center opacity-40">
          <p class="text-sm mb-1">Select a session to view events</p>
          <p class="text-[10px]">Events stream here in real-time</p>
        </div>
      </div>
      <div id="event-panel" class="flex-1 overflow-y-auto hidden" tabindex="-1">
        <div id="event-viewport" class="relative w-full">
          <div id="event-sentinel" style="height:0"></div>
          <div id="event-body"></div>
        </div>
      </div>
      <!-- Event Detail Panel -->
      <div id="detail-handle" class="resize-handle-y hidden"></div>
      <div id="detail-panel" class="hidden border-t border-base-300 flex flex-col bg-base-100" style="height:224px;min-height:80px;max-height:80vh;">
        <div class="flex items-center justify-between px-3 py-2 border-b border-base-200 flex-shrink-0">
          <div class="flex items-center gap-2">
            <span id="detail-badge" class="badge badge-sm text-[10px]"></span>
            <span id="detail-time" class="text-[10px] opacity-40"></span>
          </div>
          <button id="detail-close" class="btn btn-xs btn-ghost opacity-40">esc</button>
        </div>
        <div id="detail-content" class="flex-1 overflow-y-auto px-3 py-2"></div>
      </div>
    </div>

  </div> <!-- /list-view -->

  <!-- Feed View -->
  <div id="feed-view" class="h-[calc(100vh-2.5rem)] flex flex-col hidden">
    <div class="px-3 sm:px-4 py-2 border-b border-base-300 flex items-center justify-between gap-2">
      <div class="flex items-center gap-2 min-w-0">
        <button id="feed-back" class="btn btn-xs btn-ghost opacity-60" title="Back to sessions">
          <i data-lucide="arrow-left" class="w-3.5 h-3.5"></i>
        </button>
        <span class="font-semibold text-[10px] opacity-50 uppercase tracking-wider whitespace-nowrap">Live Feed</span>
        <span id="feed-count" class="badge badge-sm badge-ghost text-[10px]">0</span>
      </div>
      <div class="flex items-center gap-2">
        <div class="dropdown dropdown-end">
          <div id="feed-source-filter" tabindex="0" role="button" class="btn btn-xs btn-ghost text-[10px] gap-1" data-value="">All sources <span class="opacity-40">&#9662;</span></div>
          <ul id="feed-source-menu" tabindex="0" class="dropdown-content menu menu-xs bg-base-200 border border-base-300 rounded-lg z-50 w-48 p-1 shadow-lg mt-1 max-h-48 overflow-y-auto"></ul>
        </div>
      </div>
    </div>
    <div id="feed-list" class="flex-1 overflow-y-auto">
      <div id="feed-empty" class="flex items-center justify-center h-full">
        <div class="text-center opacity-40">
          <i data-lucide="radio" class="w-6 h-6 mx-auto mb-2 opacity-30"></i>
          <p class="text-sm mb-1">No feed entries yet</p>
          <p class="text-[10px]">Messages from data sources appear here in real-time</p>
          <button onclick="switchView('integrations'); showIntegrationPanel('sources')" class="btn btn-xs btn-ghost mt-3 opacity-70">Add data source</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Insights View -->
  <div id="insights-view" class="h-[calc(100vh-2.5rem)] flex hidden">
    <!-- Insights List (Left Panel) -->
    <div id="insights-sidebar" class="border-r border-base-300 overflow-y-auto bg-base-100 flex flex-col" style="width:320px;min-width:200px;max-width:50vw;">
      <div class="px-3 py-2 border-b border-base-300 flex items-center justify-between gap-2">
        <div class="flex items-center gap-2 min-w-0">
          <button id="insights-back" class="btn btn-xs btn-ghost opacity-60" title="Back to sessions">
            <i data-lucide="arrow-left" class="w-3.5 h-3.5"></i>
          </button>
          <span class="font-semibold text-[10px] opacity-50 uppercase tracking-wider whitespace-nowrap">Insights</span>
          <span id="insights-count" class="badge badge-sm badge-ghost text-[10px]">0</span>
        </div>
        <div class="dropdown dropdown-end">
          <div id="insights-user-filter" tabindex="0" role="button" class="btn btn-xs btn-ghost text-[10px] gap-1" data-value="">All users <span class="opacity-40">▾</span></div>
          <ul id="insights-user-menu" tabindex="0" class="dropdown-content menu menu-xs bg-base-200 border border-base-300 rounded-lg z-50 w-44 p-1 shadow-lg mt-1 max-h-48 overflow-y-auto"></ul>
        </div>
      </div>
      <div id="insights-list" class="flex-1 overflow-y-auto">
        <div id="insights-empty" class="p-4 text-center opacity-40 text-xs">
          <i data-lucide="lightbulb" class="w-6 h-6 mx-auto mb-2 opacity-30"></i>
          <p class="mb-1">No insights yet</p>
          <p class="text-[10px]">Generated every 30 minutes</p>
        </div>
      </div>
    </div>
    <div id="insights-sidebar-handle" class="resize-handle-x"></div>

    <!-- Insight Detail (Right Panel) -->
    <div id="insights-main" class="flex-1 flex flex-col overflow-hidden">
      <!-- Mobile back button for insights -->
      <div id="insights-mobile-back" class="hidden items-center gap-2 px-3 py-2.5 border-b border-base-300 bg-base-100 cursor-pointer active:bg-base-200 transition-colors" onclick="insightsMobileBack()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="opacity-50"><path d="M15 18l-6-6 6-6"/></svg>
        <span class="text-xs font-medium opacity-60">Insights</span>
      </div>
      <div id="insights-detail-empty" class="flex items-center justify-center flex-1">
        <div class="text-center opacity-40">
          <i data-lucide="file-text" class="w-8 h-8 mx-auto mb-2 opacity-30"></i>
          <p class="text-sm mb-1">Select an insight to view details</p>
          <p class="text-[10px]">Insights contain AI-generated analysis of your sessions</p>
        </div>
      </div>
      <div id="insights-detail" class="flex-1 overflow-y-auto hidden">
        <div class="px-5 sm:px-8 py-5 border-b border-base-200 bg-base-100 sticky top-0 z-10">
          <div class="flex items-start justify-between gap-3">
            <div class="flex-1 min-w-0">
              <h1 id="insight-detail-user" class="text-base font-semibold tracking-tight text-base-content mb-0.5"></h1>
              <p id="insight-detail-repo" class="text-xs text-base-content/50 mb-2"></p>
              <div id="insight-detail-meta" class="text-[10px] text-base-content/40 flex flex-wrap gap-x-2 gap-y-1"></div>
            </div>
            <button id="insight-detail-delete" class="btn btn-xs btn-ghost opacity-30 hover:opacity-100 hover:text-error" title="Delete insight">
              <i data-lucide="trash-2" class="w-3.5 h-3.5"></i>
            </button>
          </div>
        </div>
        <div id="insight-detail-content" class="px-5 sm:px-8 py-6 insight-content"></div>
      </div>
    </div>
  </div> <!-- /insights-view -->

  <!-- Integrations View -->
  <div id="integrations-view" class="h-[calc(100vh-2.5rem)] flex hidden">
    <!-- Integrations Sidebar -->
    <div id="integrations-sidebar" class="border-r border-base-300 overflow-y-auto bg-base-100 flex flex-col" style="width:220px;min-width:150px;max-width:40vw;">
      <div class="px-3 py-2 border-b border-base-300 flex items-center gap-2">
        <button id="integrations-back" class="btn btn-xs btn-ghost opacity-60" title="Back to sessions">
          <i data-lucide="arrow-left" class="w-3.5 h-3.5"></i>
        </button>
        <span class="font-semibold text-[10px] opacity-50 uppercase tracking-wider whitespace-nowrap">Integrations</span>
      </div>
      <div class="flex-1 overflow-y-auto">
        <div class="integration-nav-item px-3 py-3 cursor-pointer border-b border-base-200 border-l-3 border-l-primary bg-base-200/50 flex items-center gap-2" data-integration="slack">
          <svg width="16" height="16" viewBox="0 0 127 127" fill="none"><path d="M27.2 80a13.6 13.6 0 0 1-13.6 13.6A13.6 13.6 0 0 1 0 80a13.6 13.6 0 0 1 13.6-13.6h13.6V80zm6.8 0a13.6 13.6 0 0 1 13.6-13.6 13.6 13.6 0 0 1 13.6 13.6v34a13.6 13.6 0 0 1-13.6 13.6A13.6 13.6 0 0 1 34 114V80z" fill="#E01E5A"/><path d="M47.6 27.2A13.6 13.6 0 0 1 34 13.6 13.6 13.6 0 0 1 47.6 0 13.6 13.6 0 0 1 61.2 13.6v13.6H47.6zm0 6.8a13.6 13.6 0 0 1 13.6 13.6 13.6 13.6 0 0 1-13.6 13.6H13.6A13.6 13.6 0 0 1 0 47.6 13.6 13.6 0 0 1 13.6 34h34z" fill="#36C5F0"/><path d="M99.8 47.6a13.6 13.6 0 0 1 13.6-13.6 13.6 13.6 0 0 1 13.6 13.6 13.6 13.6 0 0 1-13.6 13.6H99.8V47.6zm-6.8 0a13.6 13.6 0 0 1-13.6 13.6 13.6 13.6 0 0 1-13.6-13.6V13.6A13.6 13.6 0 0 1 79.4 0 13.6 13.6 0 0 1 93 13.6v34z" fill="#2EB67D"/><path d="M79.4 99.8a13.6 13.6 0 0 1 13.6 13.6 13.6 13.6 0 0 1-13.6 13.6 13.6 13.6 0 0 1-13.6-13.6V99.8h13.6zm0-6.8a13.6 13.6 0 0 1-13.6-13.6A13.6 13.6 0 0 1 79.4 66h34a13.6 13.6 0 0 1 13.6 13.6 13.6 13.6 0 0 1-13.6 13.4H79.4z" fill="#ECB22E"/></svg>
          <span class="text-xs font-medium">Slack</span>
        </div>
        <div class="integration-nav-item px-3 py-3 cursor-pointer border-b border-base-200 border-l-3 border-l-transparent flex items-center gap-2" data-integration="discord">
          <svg width="16" height="16" viewBox="0 0 127.14 96.36" fill="none"><path d="M107.7 8.07A105.15 105.15 0 0 0 81.47 0a72.06 72.06 0 0 0-3.36 6.83 97.68 97.68 0 0 0-29.11 0A72.37 72.37 0 0 0 45.64 0 105.89 105.89 0 0 0 19.39 8.09C2.79 32.65-1.71 56.6.54 80.21a105.73 105.73 0 0 0 32.17 16.15 77.7 77.7 0 0 0 6.89-11.11 68.42 68.42 0 0 1-10.85-5.18c.91-.66 1.8-1.34 2.66-2.03a75.57 75.57 0 0 0 64.32 0c.87.71 1.76 1.39 2.66 2.03a68.68 68.68 0 0 1-10.87 5.19 77.21 77.21 0 0 0 6.89 11.1 105.25 105.25 0 0 0 32.19-16.14c2.64-27.38-4.51-51.11-18.9-72.15zM42.45 65.69C36.18 65.69 31 60 31 53.05s5-12.68 11.45-12.68S53.98 46 53.89 53.05 48.84 65.69 42.45 65.69zm42.24 0C78.41 65.69 73.25 60 73.25 53.05s5-12.68 11.44-12.68S96.23 46 96.14 53.05 91.08 65.69 84.69 65.69z" fill="#5865F2"/></svg>
          <span class="text-xs font-medium">Discord</span>
        </div>
        <div class="integration-nav-item px-3 py-3 cursor-pointer border-b border-base-200 border-l-3 border-l-transparent flex items-center gap-2" data-integration="sources">
          <i data-lucide="rss" class="w-4 h-4 opacity-60"></i>
          <span class="text-xs font-medium">Data Sources</span>
        </div>
      </div>
    </div>

    <!-- Integrations Main Panel -->
    <div id="integrations-main" class="flex-1 overflow-y-auto">
      <!-- Data Sources Panel (hidden by default) -->
      <div id="sources-panel" class="hidden max-w-2xl mx-auto px-5 sm:px-8 py-6">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-base font-semibold">Data Sources</h2>
          <button id="sources-add-btn" class="btn btn-sm btn-primary text-xs gap-1">
            <i data-lucide="plus" class="w-3.5 h-3.5"></i> Add Source
          </button>
        </div>
        <div id="sources-list" class="space-y-2 mb-6">
          <div class="text-xs opacity-40 p-4 text-center">No data sources configured</div>
        </div>
        <!-- Add/Edit Source Form (hidden by default) -->
        <div id="sources-form" class="hidden border border-base-300 rounded-lg p-4 mb-6">
          <h3 id="sources-form-title" class="text-sm font-semibold mb-3">Add Data Source</h3>
          <div class="space-y-3">
            <div>
              <label class="label text-xs py-0.5 font-medium">Name</label>
              <input type="text" id="source-name" class="input input-sm input-bordered w-full text-xs" placeholder="Engineering Slack" />
            </div>
            <div>
              <label class="label text-xs py-0.5 font-medium">Type</label>
              <select id="source-type" class="select select-sm select-bordered w-full text-xs">
                <option value="slack">Slack Channel</option>
                <option value="discord">Discord Channel</option>
                <option value="rss">RSS Feed</option>
              </select>
            </div>
            <!-- Slack config -->
            <div id="source-config-slack">
              <label class="label text-xs py-0.5 font-medium">Channel</label>
              <div class="relative" style="position:relative" id="source-slack-channel-dropdown-wrap">
                <input type="text" id="source-slack-channel" class="input input-sm input-bordered w-full text-xs font-mono" placeholder="Search channels or enter ID..." autocomplete="off" />
                <input type="hidden" id="source-slack-channel-id" />
                <div id="source-slack-channel-dropdown" class="hidden absolute z-50 left-0 right-0 top-full mt-1 bg-base-100 border border-base-300 rounded-lg shadow-lg max-h-48 overflow-y-auto"></div>
              </div>
              <p class="text-[10px] opacity-40 mt-1">Uses the existing Slack bot connection</p>
            </div>
            <!-- Discord config -->
            <div id="source-config-discord" class="hidden space-y-3">
              <div>
                <label class="label text-xs py-0.5 font-medium">Server</label>
                <select id="source-discord-guild" class="select select-sm select-bordered w-full text-xs">
                  <option value="">Select a server...</option>
                </select>
              </div>
              <div>
                <label class="label text-xs py-0.5 font-medium">Channel</label>
                <div class="relative" id="source-discord-channel-dropdown-wrap">
                  <input type="text" id="source-discord-channel" class="input input-sm input-bordered w-full text-xs font-mono" placeholder="Select a server first..." autocomplete="off" disabled />
                  <input type="hidden" id="source-discord-channel-id" />
                  <div id="source-discord-channel-dropdown" class="hidden absolute z-50 left-0 right-0 top-full mt-1 bg-base-100 border border-base-300 rounded-lg shadow-lg max-h-48 overflow-y-auto"></div>
                </div>
              </div>
              <p class="text-[10px] opacity-40 mt-1">Uses the Discord bot connection configured in Discord integration</p>
            </div>
            <!-- RSS config -->
            <div id="source-config-rss" class="hidden space-y-3">
              <div>
                <label class="label text-xs py-0.5 font-medium">Feed URL</label>
                <input type="text" id="source-rss-url" class="input input-sm input-bordered w-full text-xs font-mono" placeholder="https://example.com/feed.xml" />
              </div>
              <div>
                <label class="label text-xs py-0.5 font-medium">Poll Interval (minutes)</label>
                <input type="number" id="source-rss-interval" class="input input-sm input-bordered w-24 text-xs" value="15" min="1" />
              </div>
            </div>
            <!-- Field mapping (collapsible) -->
            <details class="border border-base-300 rounded-lg overflow-hidden">
              <summary class="px-3 py-2 text-xs font-medium cursor-pointer bg-base-200/30 opacity-60 hover:opacity-100">Advanced: Field Mapping</summary>
              <div class="px-3 py-3 space-y-2">
                <div class="grid grid-cols-2 gap-2">
                  <div>
                    <label class="label text-[10px] py-0">Author path</label>
                    <input type="text" id="source-map-author" class="input input-xs input-bordered w-full text-[10px] font-mono" placeholder="auto" />
                  </div>
                  <div>
                    <label class="label text-[10px] py-0">Content path</label>
                    <input type="text" id="source-map-content" class="input input-xs input-bordered w-full text-[10px] font-mono" placeholder="auto" />
                  </div>
                  <div>
                    <label class="label text-[10px] py-0">URL path</label>
                    <input type="text" id="source-map-url" class="input input-xs input-bordered w-full text-[10px] font-mono" placeholder="auto" />
                  </div>
                  <div>
                    <label class="label text-[10px] py-0">Timestamp path</label>
                    <input type="text" id="source-map-timestamp" class="input input-xs input-bordered w-full text-[10px] font-mono" placeholder="auto" />
                  </div>
                </div>
              </div>
            </details>
            <div class="flex gap-2 pt-1">
              <button id="source-save-btn" class="btn btn-sm btn-primary text-xs">Save</button>
              <button id="source-cancel-btn" class="btn btn-sm btn-ghost text-xs">Cancel</button>
            </div>
            <div id="source-save-status" class="text-xs hidden"></div>
          </div>
        </div>
      </div>

      <!-- Discord Panel -->
      <div id="discord-panel" class="hidden max-w-2xl mx-auto px-5 sm:px-8 py-6">
        <!-- Status -->
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-base font-semibold">Discord Integration</h2>
          <div id="discord-status-badge" class="flex items-center gap-1.5">
            <span id="discord-status-dot" class="inline-block w-2 h-2 rounded-full bg-base-300"></span>
            <span id="discord-status-text" class="text-[10px] opacity-50">Not configured</span>
          </div>
        </div>

        <!-- Config Form -->
        <div class="space-y-4 mb-6">
          <div>
            <label class="label text-xs py-0.5 font-medium">Bot Token</label>
            <div class="flex gap-2">
              <input type="password" id="discord-bot-token" class="input input-sm input-bordered flex-1 text-xs font-mono" placeholder="Bot token..." />
              <button id="discord-toggle-bot-token" class="btn btn-xs btn-ghost opacity-50" title="Toggle visibility">
                <i data-lucide="eye" class="w-3.5 h-3.5"></i>
              </button>
            </div>
          </div>
          <div class="flex gap-2">
            <button id="discord-save-btn" class="btn btn-sm btn-primary text-xs">Save</button>
            <button id="discord-test-btn" class="btn btn-sm btn-ghost text-xs">Test Connection</button>
          </div>
          <div id="discord-save-status" class="text-xs hidden"></div>
        </div>

        <!-- Setup Guide -->
        <div class="border-t border-base-300 pt-6">
          <h3 class="text-sm font-semibold mb-3 opacity-70">Setup Guide</h3>
          <ol class="text-xs opacity-60 space-y-2 list-decimal pl-5 leading-relaxed">
            <li>Go to the <a href="https://discord.com/developers/applications" target="_blank" class="underline">Discord Developer Portal</a> and create a new application</li>
            <li>Go to <strong>Bot</strong> &rarr; click <strong>Reset Token</strong> to generate a bot token</li>
            <li>Enable <strong>Message Content Intent</strong> under Privileged Gateway Intents</li>
            <li>Go to <strong>OAuth2</strong> &rarr; URL Generator &rarr; select <code class="bg-base-200 px-1 rounded">bot</code> scope with permissions: <code class="bg-base-200 px-1 rounded">Read Messages/View Channels</code>, <code class="bg-base-200 px-1 rounded">Read Message History</code></li>
            <li>Use the generated URL to invite the bot to your server</li>
            <li>Paste the bot token above and test the connection</li>
          </ol>
        </div>
      </div>

      <!-- Slack Panel -->
      <div id="slack-panel" class="max-w-2xl mx-auto px-5 sm:px-8 py-6">
        <!-- Status -->
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-base font-semibold">Slack Integration</h2>
          <div id="slack-status-badge" class="flex items-center gap-1.5">
            <span id="slack-status-dot" class="inline-block w-2 h-2 rounded-full bg-base-300"></span>
            <span id="slack-status-text" class="text-[10px] opacity-50">Not configured</span>
          </div>
        </div>

        <!-- Config Form -->
        <div class="space-y-4 mb-6">
          <div>
            <label class="label text-xs py-0.5 font-medium">Bot Token</label>
            <div class="flex gap-2">
              <input type="password" id="slack-bot-token" class="input input-sm input-bordered flex-1 text-xs font-mono" placeholder="xoxb-..." />
              <button id="slack-toggle-bot-token" class="btn btn-xs btn-ghost opacity-50" title="Toggle visibility">
                <i data-lucide="eye" class="w-3.5 h-3.5"></i>
              </button>
            </div>
          </div>
          <div>
            <label class="label text-xs py-0.5 font-medium">App Token</label>
            <div class="flex gap-2">
              <input type="password" id="slack-app-token" class="input input-sm input-bordered flex-1 text-xs font-mono" placeholder="xapp-..." />
              <button id="slack-toggle-app-token" class="btn btn-xs btn-ghost opacity-50" title="Toggle visibility">
                <i data-lucide="eye" class="w-3.5 h-3.5"></i>
              </button>
            </div>
          </div>
          <div>
            <label class="label text-xs py-0.5 font-medium">Default Channel</label>
            <div class="relative" id="slack-channel-dropdown-wrap">
              <input type="text" id="slack-channel" class="input input-sm input-bordered w-full text-xs font-mono" placeholder="Search channels or enter ID..." autocomplete="off" />
              <input type="hidden" id="slack-channel-id" />
              <div id="slack-channel-dropdown" class="hidden absolute z-50 left-0 right-0 top-full mt-1 bg-base-100 border border-base-300 rounded-lg shadow-lg max-h-48 overflow-y-auto"></div>
            </div>
          </div>
          <div class="flex gap-2">
            <button id="slack-save-btn" class="btn btn-sm btn-primary text-xs">Save</button>
            <button id="slack-test-btn" class="btn btn-sm btn-ghost text-xs">Test Connection</button>
          </div>
          <div id="slack-save-status" class="text-xs hidden"></div>
        </div>

        <!-- Setup Guide -->
        <div class="border-t border-base-300 pt-6">
          <h3 class="text-sm font-semibold mb-3 opacity-70">Setup Guide</h3>
          <ol class="text-xs opacity-60 space-y-2 list-decimal pl-5 leading-relaxed">
            <li>Create a new app at <a href="https://api.slack.com/apps" target="_blank" class="underline">api.slack.com/apps</a> (choose "From scratch")</li>
            <li>Go to <strong>Socket Mode</strong> &rarr; Enable &rarr; generates an <code class="bg-base-200 px-1 rounded">xapp-</code> token</li>
            <li>Go to <strong>OAuth &amp; Permissions</strong> &rarr; add Bot Token Scopes: <code class="bg-base-200 px-1 rounded">chat:write</code>, <code class="bg-base-200 px-1 rounded">reactions:write</code>, <code class="bg-base-200 px-1 rounded">users:read</code></li>
            <li>Go to <strong>Event Subscriptions</strong> &rarr; Enable &rarr; Subscribe to: <code class="bg-base-200 px-1 rounded">message.channels</code>, <code class="bg-base-200 px-1 rounded">message.groups</code></li>
            <li>Enable <strong>Interactivity &amp; Shortcuts</strong> (no URL needed in Socket Mode)</li>
            <li>Install app to workspace &rarr; copy <code class="bg-base-200 px-1 rounded">xoxb-</code> Bot Token</li>
            <li>Invite the bot to the channel you want to use</li>
          </ol>
        </div>
      </div>
    </div>
  </div> <!-- /integrations-view -->

  <!-- Invite Dialog -->
  <dialog id="invite-dialog" class="modal">
    <div class="modal-box max-w-md p-0 flex flex-col max-h-[90vh] sm:max-h-[80vh] w-[calc(100%-1rem)] sm:w-auto">
      <div class="sticky top-0 bg-base-100 z-10 px-6 pt-5 pb-3 border-b border-base-300">
        <form method="dialog">
          <button class="btn btn-sm btn-circle btn-ghost absolute right-3 top-3"><i data-lucide="x" class="w-4 h-4"></i></button>
        </form>
        <h3 class="text-base font-bold">Invite User</h3>
      </div>

      <div class="px-6 py-4 space-y-4 overflow-y-auto flex-1">
        <!-- Create invite form -->
        <div>
          <label class="label text-xs py-0.5">Email (optional)</label>
          <div class="flex gap-2">
            <input type="email" id="invite-email" class="input input-sm input-bordered flex-1 text-xs" placeholder="user@example.com" />
            <button id="invite-create-btn" class="btn btn-sm btn-primary text-xs">Create</button>
          </div>
        </div>

        <!-- Generated link display (hidden initially) -->
        <div id="invite-link-box" class="hidden">
          <label class="label text-xs py-0.5 font-semibold">Invite Link</label>
          <div class="flex gap-2">
            <input type="text" id="invite-link-input" class="input input-sm input-bordered flex-1 text-xs" readonly />
            <button id="invite-copy-btn" class="btn btn-sm btn-ghost text-xs">copy</button>
          </div>
        </div>

        <!-- Invite list -->
        <div>
          <label class="label text-xs py-0.5 font-semibold">Invites</label>
          <div id="invite-list" class="space-y-1 text-xs">
            <div class="opacity-40">Loading...</div>
          </div>
        </div>
      </div>
    </div>
    <form method="dialog" class="modal-backdrop"><button>close</button></form>
  </dialog>

  <!-- Help Dialog -->
  <dialog id="help-dialog" class="modal">
    <div class="modal-box max-w-2xl max-h-[90vh] sm:max-h-[80vh] p-0 flex flex-col w-[calc(100%-1rem)] sm:w-auto">
      <div class="sticky top-0 bg-base-100 z-10 px-6 pt-5 pb-3 border-b border-base-300">
        <form method="dialog">
          <button class="btn btn-sm btn-circle btn-ghost absolute right-3 top-3"><i data-lucide="x" class="w-4 h-4"></i></button>
        </form>
        <h3 class="text-base font-bold">Connect your agent to AgentFlow</h3>
      </div>

      <!-- Tab bar -->
      <div class="flex border-b border-base-300 px-4 gap-1 overflow-x-auto flex-shrink-0" id="setup-tabs">
        <button class="setup-tab tab tab-bordered tab-active text-[11px] whitespace-nowrap" data-tab="tab-claude">
          <svg width="12" height="12" viewBox="0 0 248 248" fill="none" class="mr-1 flex-shrink-0"><path d="M52.4285 162.873L98.7844 136.879L99.5485 134.602L98.7844 133.334H96.4921L88.7237 132.862L62.2346 132.153L39.3113 131.207L17.0249 130.026L11.4214 128.844L6.2 121.873L6.7094 118.447L11.4214 115.257L18.171 115.847L33.0711 116.911L55.485 118.447L71.6586 119.392L95.728 121.873H99.5485L100.058 120.337L98.7844 119.392L97.7656 118.447L74.5877 102.732L49.4995 86.1905L36.3823 76.62L29.3779 71.7757L25.8121 67.2858L24.2839 57.3608L30.6515 50.2716L39.3113 50.8623L41.4763 51.4531L50.2636 58.1879L68.9842 72.7209L93.4357 90.6804L97.0015 93.6343L98.4374 92.6652L98.6571 91.9801L97.0015 89.2625L83.757 65.2772L69.621 40.8192L63.2534 30.6579L61.5978 24.632C60.9565 22.1032 60.579 20.0111 60.579 17.4246L67.8381 7.49965L71.9133 6.19995L81.7193 7.49965L85.7946 11.0443L91.9074 24.9865L101.714 46.8451L116.996 76.62L121.453 85.4816L123.873 93.6343L124.764 96.1155H126.292V94.6976L127.566 77.9197L129.858 57.3608L132.15 30.8942L132.915 23.4505L136.608 14.4708L143.994 9.62643L149.725 12.344L154.437 19.0788L153.8 23.4505L150.998 41.6463L145.522 70.1215L141.957 89.2625H143.994L146.414 86.7813L156.093 74.0206L172.266 53.698L179.398 45.6635L187.803 36.802L193.152 32.5484H203.34L210.726 43.6549L207.415 55.1159L196.972 68.3492L188.312 79.5739L175.896 96.2095L168.191 109.585L168.882 110.689L170.738 110.53L198.755 104.504L213.91 101.787L231.994 98.7149L240.144 102.496L241.036 106.395L237.852 114.311L218.495 119.037L195.826 123.645L162.07 131.592L161.696 131.893L162.137 132.547L177.36 133.925L183.855 134.279H199.774L229.447 136.524L237.215 141.605L241.8 147.867L241.036 152.711L229.065 158.737L213.019 154.956L175.45 145.977L162.587 142.787H160.805V143.85L171.502 154.366L191.242 172.089L215.82 195.011L217.094 200.682L213.91 205.172L210.599 204.699L188.949 188.394L180.544 181.069L161.696 165.118H160.422V166.772L164.752 173.152L187.803 207.771L188.949 218.405L187.294 221.832L181.308 223.959L174.813 222.777L161.187 203.754L147.305 182.486L136.098 163.345L134.745 164.2L128.075 235.42L125.019 239.082L117.887 241.8L111.902 237.31L108.718 229.984L111.902 215.452L115.722 196.547L118.779 181.541L121.58 162.873L123.291 156.636L123.14 156.219L121.773 156.449L107.699 175.752L86.304 204.699L69.3663 222.777L65.291 224.431L58.2867 220.768L58.9235 214.27L62.8713 208.48L86.304 178.705L100.44 160.155L109.551 149.507L109.462 147.967L108.959 147.924L46.6977 188.512L35.6182 189.93L30.7788 185.44L31.4156 178.115L33.7079 175.752L52.4285 162.873Z" fill="#D97757"/></svg>
          Claude Code
        </button>
        <button class="setup-tab tab tab-bordered text-[11px] whitespace-nowrap" data-tab="tab-codex">
          <svg width="12" height="12" viewBox="29 29 122 122" fill="currentColor" class="mr-1 flex-shrink-0"><path d="M75.91 73.628V62.232c0-.96.36-1.68 1.199-2.16l22.912-13.194c3.119-1.8 6.838-2.639 10.676-2.639 14.394 0 23.511 11.157 23.511 23.032 0 .839 0 1.799-.12 2.758l-23.752-13.914c-1.439-.84-2.879-.84-4.318 0L75.91 73.627Zm53.499 44.383v-27.23c0-1.68-.72-2.88-2.159-3.719L97.142 69.55l9.836-5.638c.839-.48 1.559-.48 2.399 0l22.912 13.195c6.598 3.839 11.035 11.995 11.035 19.912 0 9.116-5.397 17.513-13.915 20.992v.001Zm-60.577-23.99-9.836-5.758c-.84-.48-1.2-1.2-1.2-2.16v-26.39c0-12.834 9.837-22.55 23.152-22.55 5.039 0 9.716 1.679 13.676 4.678L70.993 55.516c-1.44.84-2.16 2.039-2.16 3.719v34.787-.002Zm21.173 12.234L75.91 98.339V81.546l14.095-7.917 14.094 7.917v16.793l-14.094 7.916Zm9.056 36.467c-5.038 0-9.716-1.68-13.675-4.678l23.631-13.676c1.439-.839 2.159-2.038 2.159-3.718V85.863l9.956 5.757c.84.48 1.2 1.2 1.2 2.16v26.389c0 12.835-9.957 22.552-23.27 22.552v.001Zm-28.43-26.75L47.72 102.778c-6.599-3.84-11.036-11.996-11.036-19.913 0-9.236 5.518-17.513 14.034-20.992v27.35c0 1.68.72 2.879 2.16 3.718l29.989 17.393-9.837 5.638c-.84.48-1.56.48-2.399 0Zm-1.318 19.673c-13.555 0-23.512-10.196-23.512-22.792 0-.959.12-1.919.24-2.879l23.63 13.675c1.44.84 2.88.84 4.32 0l30.108-17.392v11.395c0 .96-.361 1.68-1.2 2.16l-22.912 13.194c-3.119 1.8-6.837 2.639-10.675 2.639Z"/></svg>
          Codex
        </button>
        <button class="setup-tab tab tab-bordered text-[11px] whitespace-nowrap" data-tab="tab-sdk-ts">SDK (TS)</button>
        <button class="setup-tab tab tab-bordered text-[11px] whitespace-nowrap" data-tab="tab-sdk-py">SDK (Py)</button>
        <button class="setup-tab tab tab-bordered text-[11px] whitespace-nowrap" data-tab="tab-opencode">
          <img src="https://opencode.ai/favicon-v3.ico" width="12" height="12" class="mr-1 flex-shrink-0" />
          Open Code
        </button>
        <button class="setup-tab tab tab-bordered text-[11px] whitespace-nowrap" data-tab="tab-curl">
          <i data-lucide="send" class="w-3 h-3 mr-1 opacity-60"></i>
          Test
        </button>
      </div>

      <!-- Tab panels -->
      <div class="px-6 py-4 overflow-y-auto flex-1 text-xs">
        <div id="tab-claude" class="setup-panel">
          <p class="opacity-60 mb-2">Download the hook script and configure your settings:</p>
          <div class="relative">
            <pre id="claude-config" class="bg-base-200 p-3 rounded-lg overflow-x-auto text-[11px] leading-relaxed"></pre>
            <button class="btn btn-xs btn-ghost absolute top-2 right-2 copy-btn" data-target="claude-config">copy</button>
          </div>
        </div>

        <div id="tab-codex" class="setup-panel hidden">
          <p class="opacity-60 mb-2">Pipe JSON output to AgentFlow:</p>
          <div class="relative">
            <pre id="codex-config" class="bg-base-200 p-3 rounded-lg overflow-x-auto text-[11px] leading-relaxed"></pre>
            <button class="btn btn-xs btn-ghost absolute top-2 right-2 copy-btn" data-target="codex-config">copy</button>
          </div>
        </div>

        <div id="tab-sdk-ts" class="setup-panel hidden">
          <p class="opacity-60 mb-2">Stream events from <code class="bg-base-200 px-1 rounded">@anthropic-ai/claude-agent-sdk</code>:</p>
          <div class="relative">
            <pre id="agent-sdk-ts-config" class="bg-base-200 p-3 rounded-lg overflow-x-auto text-[11px] leading-relaxed"></pre>
            <button class="btn btn-xs btn-ghost absolute top-2 right-2 copy-btn" data-target="agent-sdk-ts-config">copy</button>
          </div>
        </div>

        <div id="tab-sdk-py" class="setup-panel hidden">
          <p class="opacity-60 mb-2">Stream events from <code class="bg-base-200 px-1 rounded">claude-agent-sdk</code>:</p>
          <div class="relative">
            <pre id="agent-sdk-py-config" class="bg-base-200 p-3 rounded-lg overflow-x-auto text-[11px] leading-relaxed"></pre>
            <button class="btn btn-xs btn-ghost absolute top-2 right-2 copy-btn" data-target="agent-sdk-py-config">copy</button>
          </div>
        </div>

        <div id="tab-opencode" class="setup-panel hidden">
          <p class="opacity-60 mb-2">Install the plugin to stream events from <a href="https://github.com/anomalyco/opencode" target="_blank" class="underline">Open Code</a>:</p>
          <div class="relative">
            <pre id="opencode-config" class="bg-base-200 p-3 rounded-lg overflow-x-auto text-[11px] leading-relaxed"></pre>
            <button class="btn btn-xs btn-ghost absolute top-2 right-2 copy-btn" data-target="opencode-config">copy</button>
          </div>
        </div>

        <div id="tab-curl" class="setup-panel hidden">
          <p class="opacity-60 mb-2">Send a test event to verify your setup:</p>
          <div class="relative">
            <pre id="curl-config" class="bg-base-200 p-3 rounded-lg overflow-x-auto text-[11px] leading-relaxed"></pre>
            <button class="btn btn-xs btn-ghost absolute top-2 right-2 copy-btn" data-target="curl-config">copy</button>
          </div>
        </div>
      </div>

      <div class="sticky bottom-0 bg-base-100 border-t border-base-300 px-6 py-3 hidden sm:block">
        <div class="opacity-40 text-[10px] flex items-center gap-2">
          <i data-lucide="keyboard" class="w-3 h-3"></i>
          <p><b>Keyboard:</b> v toggle view, j/k navigate, Enter/l to view events, Escape/h back, ? help</p>
        </div>
      </div>
    </div>
    <form method="dialog" class="modal-backdrop"><button>close</button></form>
  </dialog>

  <div id="toast-container" class="toast toast-end toast-bottom z-50"></div>
  <div id="bubble-tooltip" class="bubble-tooltip"></div>

  <script src="https://unpkg.com/lucide@latest"></script>
  <script src="https://cdn.socket.io/4.8.3/socket.io.min.js"></script>
  <script src="/app.js"></script>
</body>
</html>
